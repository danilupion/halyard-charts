# Configuration that is passed to the upstream Bitnami Matomo chart via the
# dependency alias "bitnami-matomo".
bitnamiMatomo:
  fullnameOverride: matomo

  global:
    imageRegistry: ghcr.io

  replicaCount: 1

  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi

  persistence:
    enabled: true
    storageClass: ""
    size: 30Gi

  ingress:
    enabled: true
    ingressClassName: nginx-public
    hostname: matomo.example.com
    path: /
    pathType: ImplementationSpecific
    certManager: false
    selfSigned: false
    annotations: {}
    extraHosts: []
    extraPaths: []
    extraTls: []
    secrets: []

  service:
    type: ClusterIP
    ports:
      http: 80

  mariadb:
    enabled: true
    auth:
      rootPassword: ""
      existingSecret: "" # if set, use external secret for DB credentials
    primary:
      persistence:
        size: 20Gi

  externalDatabase:
    enabled: false
    host: ""
    port: 3306
    user: bn_matomo
    database: bitnami_matomo
    existingSecret: ""
    existingSecretPasswordKey: mariadb-password

# CronJob importer (log-analytics)
cronjob:
  enabled: true
  schedule: "15 1 * * *"      # default daily at 01:15
  concurrencyPolicy: Replace
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  image:
    registry: docker.io
    repository: bitnami/matomo
    tag: 6.0.3-debian-12-r0
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Where to read ingress logs on the node
  # Single-node clusters: mount hostPath /var/log/containers (or adjust)
  hostPath:
    enabled: true
    path: /var/log/containers
    type: Directory

  # Node selector / tolerations to pin CronJob to the node that has logs available
  nodeSelector: {}
  tolerations: []

  # Matomo endpoint & import token (provided as k8s secret references)
  matomo:
    urlSecret: matomo-url        # secret that contains key "url"
    tokenSecret: matomo-token    # secret that contains key "token"

# optional extra args for the importer command (kept empty by default)
importerArgs: ""
