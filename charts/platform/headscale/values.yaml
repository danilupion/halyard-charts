# Headscale configuration
headscale:
  # Public URL where Headscale will be accessible (required)
  # This is the URL clients will use to connect
  serverUrl: ""

  # IP prefixes for the tailnet
  ipPrefixes:
    v4: "100.64.0.0/10"
    v6: "fd7a:115c:a1e0::/48"

  # Base domain for MagicDNS (optional)
  # If set, devices get DNS names like device.baseDomain
  baseDomain: ""

  # DNS configuration
  dns:
    # Enable MagicDNS
    magicDns: true
    # Upstream nameservers
    nameservers:
      - 1.1.1.1
      - 8.8.8.8

  # DERP (relay) configuration
  derp:
    # Use external DERP servers (Tailscale's public servers)
    externalEnabled: true
    # URL to fetch DERP map
    url: "https://controlplane.tailscale.com/derpmap/default"
    # Run embedded DERP server (useful if clients can't reach external DERP)
    embeddedEnabled: false
    embeddedPort: 3478

  # Database configuration
  database:
    # Type: sqlite or postgres
    type: sqlite
    # SQLite settings (used when type=sqlite)
    sqlite:
      path: /var/lib/headscale/db.sqlite
    # PostgreSQL settings (used when type=postgres)
    postgres:
      host: ""
      port: 5432
      name: headscale
      user: headscale
      # Password from existing secret
      existingSecret: ""
      existingSecretKey: password

  # OIDC configuration (optional)
  oidc:
    enabled: false
    issuer: ""
    clientId: ""
    # Client secret from existing secret
    existingSecret: ""
    existingSecretKey: client-secret

  # Ephemeral node cleanup timeout
  ephemeralNodeTimeout: 30m

  # Log level: trace, debug, info, warn, error
  logLevel: info

  # ACL Policy configuration
  policy:
    # Enable ACL policy
    enabled: false
    # Policy content (HuJSON format)
    # See: https://headscale.net/stable/ref/acls/
    content: ""

# Image configuration
image:
  repository: headscale/headscale
  tag: "v0.28@sha256:51b1b9182bb6219e97374fa89af6b9320d6f87ecc739e328d5357ea4fa7a5ce3"
  pullPolicy: IfNotPresent

# Resource limits
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 500m
    memory: 256Mi

# Persistence for Headscale data
persistence:
  enabled: true
  storageClass: ""
  accessModes:
    - ReadWriteOnce
  size: 1Gi

# Service configuration
service:
  type: ClusterIP
  ports:
    http: 8080
    grpc: 50443
    metrics: 9090

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  host: ""
  tls: []

# Subnet router configuration
subnetRouter:
  enabled: false

  # Stable hostname for the subnet router (recommended)
  # Use this as the exit-node target from other nodes
  hostname: ""

  # Routes to advertise (e.g., home network)
  routes: []
  # - 192.168.3.0/24

  # Tags to advertise (for ACL autoApprovers)
  # See: https://headscale.net/stable/ref/acls/#autoapprovers
  tags: []
  # - tag:subnet-router

  # Advertise as exit node (routes all internet traffic through this node)
  advertiseExitNode: false

  # Pre-auth key for the subnet router
  # Create with: headscale preauthkeys create --user admin --reusable --expiration 365d
  authKey: ""
  # Or use existing secret
  existingSecret: ""
  existingSecretKey: auth-key

  # Tailscale client image
  image:
    repository: tailscale/tailscale
    tag: stable@sha256:4a0aaacee6f28e724c1f80c986e5776c9c979d8f7e19274c2cae2d495cc8d625
    pullPolicy: IfNotPresent

  # Resource limits for subnet router
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 200m
      memory: 128Mi

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Common labels to add to all resources
commonLabels: {}

# Common annotations to add to all resources
commonAnnotations: {}

# Headplane UI configuration
ui:
  enabled: false

  image:
    repository: ghcr.io/tale/headplane
    tag: "0.6.1@sha256:74bec8f23ce57f235574b7b3e809a0d9ca500947da45dac485b5132fa4cc9fab"
    pullPolicy: IfNotPresent

  # Cookie secret for session encryption (32 characters)
  # Generate with: openssl rand -hex 16
  cookieSecret: ""
  # Or use existing secret
  existingCookieSecret: ""
  existingCookieSecretKey: cookie-secret

  # Cookie max age in seconds (default: 30 days)
  # Session expires after this time, requiring API key re-entry
  cookieMaxAge: 2592000

  # Persistence for Headplane data (API key storage, etc.)
  persistence:
    enabled: false
    storageClass: ""
    size: 100Mi

  # Ingress configuration for UI (separate domain)
  ingress:
    enabled: false
    className: ""
    annotations: {}
    host: ""
    tls: []

  # Resource limits (Node.js needs more memory)
  resources:
    requests:
      cpu: 10m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Container security context
  # Note: readOnlyRootFilesystem must be false - Headplane needs to write temp files
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL
